{% extends 'base.html' %}
{% load static %}

<!--title-->
{% block title %}Employee Profile{% endblock %}

<!--(optional)head content-->
{% block headcontent %}
<style>
    /* Add this to your employee_profile.css file */
    .message_background, .message_popup {
        transition: all 0.3s ease-in-out;
    }

    .message_background.show {
        visibility: visible !important;
        opacity: 1 !important;
    }

    .message_popup.show {
        visibility: visible !important;
        opacity: 1 !important;
    }

    /* Remove the old message styling */
    .messages {
        display: none;
    }
</style>
<link rel="stylesheet" href="{% static 'css/employee_profile.css' %}">
<link rel="stylesheet" href="{% static 'css/table.css' %}">

{% endblock %}

<!--header-->
{% block header %}EMPLOYEES{% endblock %} 

<!--page content-->
{% block outsidecontent %} 

    <!-- Background Overlay for Add Attendance -->
<div id="background_add" class="background_add fixed m-0 size-full bg-[rgba(30,30,30,0.5)] invisible opacity-0 z-50" 
onclick="cancelAddAttendance()">
</div> 

<!-- Add Attendance Popup -->
<div id="add-popup" class="add_attendance fixed w-[80%] xs:w-[90%] sm:w-[70%] md:w-[50%] lg:w-[50%] 
                      h-auto min-h-[250px] py-4 md:py-5 px-4 sm:px-6 md:px-10 
                      bg-white top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                      flex flex-col justify-around invisible opacity-0 rounded-lg z-60 overflow-hidden
                      shadow-lg">
<h1 class="text-xl sm:text-2xl md:text-3xl font-[League Spartan] font-semibold mb-2 md:mb-0">Add Attendance</h1>
<form id="add-form" class="size-full flex flex-col" method="post" action="">
   {% csrf_token %}
   <input type="hidden" name="add_attendance" value="true">
   <div class="w-full my-3 md:my-5 flex flex-col lg:flex-row gap-2 sm:gap-1">
       <div class="w-full bg-[#EFEDE6] p-3 rounded-lg sm:rounded-l-xl sm:rounded-r-none">
           <div class="w-full py-1">
               <label for="add_date" class="mx-3 font-[Inter] text-xs sm:text-sm md:text-[14px] font-semibold text-[#1E1E1E]">date</label>
           </div>
           <div class="w-full pb-1 sm:pb-0">
               <input type="date" name="date" id="add_date" class="w-full h-8 sm:h-full px-3 sm:px-5 outline-none border-none bg-transparent" required>
           </div>
       </div>
       <div class="w-full bg-[#EFEDE6] p-3 rounded-lg sm:rounded-none">
           <div class="w-full py-1">
               <label for="add_time_in" class="mx-3 font-[Inter] text-xs sm:text-sm md:text-[14px] font-semibold text-[#1E1E1E]">time in</label>
           </div>
           <div class="w-full pb-1 sm:pb-0">
               <input type="time" name="time_in" id="add_time_in" class="w-full h-8 sm:h-full px-3 sm:px-5 outline-none border-none bg-transparent" required>
           </div>
       </div>
       <div class="w-full bg-[#EFEDE6] p-3 rounded-lg sm:rounded-l-none sm:rounded-r-xl">
           <div class="w-full py-1">
               <label for="add_time_out" class="mx-3 font-[Inter] text-xs sm:text-sm md:text-[14px] font-semibold text-[#1E1E1E]">time out</label>
           </div>
           <div class="w-full pb-1 sm:pb-0">
               <input type="time" name="time_out" id="add_time_out" class="w-full h-8 sm:h-full px-3 sm:px-5 outline-none border-none bg-transparent">
           </div>
       </div>
   </div>
   <div class="w-full h-[40px] mt-2 md:mt-1 flex justify-center sm:justify-end gap-3">
       <input type="button" class="w-full sm:w-auto px-4 text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" value="CANCEL" onclick="cancelAddAttendance()">
       <input type="submit" class="w-full sm:w-auto px-4 text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" value="CONFIRM">
   </div>           
</form>
</div>

<!-- Background Overlay for Edit Attendance -->
<div id="background_edit" class="background_edit fixed m-0 size-full bg-[rgba(30,30,30,0.5)] invisible opacity-0 z-50" 
onclick="cancelEditAttendance()">
</div> 

<!-- Edit Attendance Popup -->
<div id="edit-popup" class="edit_attendance fixed w-[95%] xs:w-[90%] sm:w-[70%] md:w-[50%] lg:w-[40%] 
                       h-auto min-h-[250px] py-4 md:py-5 px-4 sm:px-6 md:px-10 
                       bg-white top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                       flex flex-col justify-around invisible opacity-0 rounded-lg z-60 overflow-hidden
                       shadow-lg">
<h1 class="text-xl sm:text-2xl md:text-3xl font-[League Spartan] font-semibold mb-2 md:mb-0">Edit Attendance</h1>
<form id="edit-form" class="size-full flex flex-col" method="post" action="">
   {% csrf_token %}
   <input type="hidden" name="edit_attendance" value="true">
   <input type="hidden" name="attendance_id" id="edit_attendance_id">
   <div class="w-full my-3 md:my-5 flex flex-col sm:flex-row gap-2 sm:gap-1">
       <div class="w-full bg-[#EFEDE6] rounded-lg sm:rounded-l-xl sm:rounded-r-none">
           <div class="w-full py-1">
               <label for="edit_date" class="mx-3 font-[Inter] text-xs sm:text-sm md:text-[14px] font-semibold text-[#1E1E1E]">date</label>
           </div>
           <div class="w-full pb-1 sm:pb-0">
               <input type="date" name="date" id="edit_date" class="w-full h-8 sm:h-full px-3 sm:px-5 outline-none border-none bg-transparent" required>
           </div>
       </div>
       <div class="w-full bg-[#EFEDE6] rounded-lg sm:rounded-none">
           <div class="w-full py-1">
               <label for="edit_time_in" class="mx-3 font-[Inter] text-xs sm:text-sm md:text-[14px] font-semibold text-[#1E1E1E]">time in</label>
           </div>
           <div class="w-full pb-1 sm:pb-0">
               <input type="time" name="time_in" id="edit_time_in" class="w-full h-8 sm:h-full px-3 sm:px-5 outline-none border-none bg-transparent" required>
           </div>
       </div>
       <div class="w-full bg-[#EFEDE6] rounded-lg sm:rounded-l-none sm:rounded-r-xl">
           <div class="w-full py-1">
               <label for="edit_time_out" class="mx-3 font-[Inter] text-xs sm:text-sm md:text-[14px] font-semibold text-[#1E1E1E]">time out</label>
           </div>
           <div class="w-full pb-1 sm:pb-0">
               <input type="time" name="time_out" id="edit_time_out" class="w-full h-8 sm:h-full px-3 sm:px-5 outline-none border-none bg-transparent">
           </div>
       </div>
   </div>
   <div class="w-full h-[40px] flex justify-center sm:justify-end gap-3">
       <input type="button" class="w-full sm:w-auto px-4 text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" value="CANCEL" onclick="cancelEditAttendance()">
       <input type="submit" class="w-full sm:w-auto px-4 text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" value="CONFIRM">
   </div>           
</form>
</div>

    <div id="background_edit" class="background_edit fixed m-0 size-full bg-[rgba(30,30,30,0.5)] invisible opacity-0 z-50" onclick="cancelEditAttendance()">
        
    </div> 

    <div id="edit-popup" class="edit_attendance fixed h-[30%] w-[80%] sm:w-[60%] md:w-[40%] py-5 px-10 bg-white top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col justify-around invisible opacity-0 rounded-lg z-60 overflow-hidden">
        <h1 class="text-3xl font-[League Spartan] font-semibold">Edit Attendance</h1>
        <form id="edit-form" class="size-full flex flex-col" method="post" action="">
            {% csrf_token %}
            <input type="hidden" name="edit_attendance" value="true">
            <input type="hidden" name="attendance_id" id="edit_attendance_id">
            <div class="w-full h-[50%] my-5 flex gap-1">
                <div class="w-full bg-[#EFEDE6] rounded-l-xl">
                    <div class="w-full h-[25%]">
                        <label for="edit_date" class="mx-3 font-[Inter] text-sm md:text-[14px] font-semibold text-[#1E1E1E]">date</label>
                    </div>
                    <div class="w-full h-[75%]">
                        <input type="date" name="date" id="edit_date" class="w-full h-full px-5 outline-none border-none" required>
                    </div>
                </div>
                <div class="w-full bg-[#EFEDE6]">
                    <div class="w-full h-[25%]">
                        <label for="edit_time_in" class="mx-3 font-[Inter] text-sm md:text-[14px] font-semibold text-[#1E1E1E]">time in</label>
                    </div>
                    <div class="w-full h-[75%]">
                        <input type="time" name="time_in" id="edit_time_in" class="w-full h-full px-5 outline-none border-none" required>
                    </div>
                </div>
                <div class="w-full bg-[#EFEDE6] rounded-r-xl">
                    <div class="w-full h-[25%]">
                        <label for="edit_time_out" class="mx-3 font-[Inter] text-sm md:text-[14px] font-semibold text-[#1E1E1E]">time out</label>
                    </div>
                    <div class="w-full h-[75%]">
                        <input type="time" name="time_out" id="edit_time_out" class="w-full h-full px-5 outline-none border-none">
                    </div>
                </div>
            </div>
            <div class="w-full h-[40px] my-1 flex justify-center sm:justify-end gap-3">
                <input type="button" class="size-full text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" value="CANCEL" onclick="cancelEditAttendance()">
                <input type="submit" class="size-full text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" value="CONFIRM">
            </div>           
        </form>
    </div>
{% endblock %}

{% block content %}
<div class="w-full h-full flex flex-col gap-5">
    <div class="w-full h-fit p-7 flex flex-col gap-3 bg-white rounded-xl">
        <div class="w-full flex gap-4">

            <div class="w-[125px] h-[125px]">
                <img src="{{ employee.employee_image.url }}" alt="Employee Image" class="size-full object-cover rounded-xl">
            </div>
            <div class="w-full flex flex-col justify-end gap-2">
                <h1 class="text-4xl font-[League Spartan] font-semibold">{{ employee.first_name }} {{ employee.last_name }} <span class="text-3xl text-[#1e1e1e80] font-semibold">{{ employee.employee_id }}</span></h1>
                
                <div class="flex items-center gap-3">
                    <div class="font-[League Spartan] text-sm font-extrabold text-[#1e1e1e80]">DETAILS</div>
                    <div class="border-2 border-[#1e1e1e20] w-[100%] h-[1px] rounded-full"></div>
                </div>
            </div>
        </div>
        <div class="w-full px-5 rounded-2xl">
            <div class="flex flex-col gap-4 sm:flex-row w-full">
                <div class="w-full sm:w-[50%] flex flex-row sm:flex-col gap-4">
                    <div class="w-[50%] flex flex-col gap-4">
                        <div class="gender">
                            <h1 class="text-sm font-bold text-[#1E1E1E66]">GENDER</h1>
                            <p class="text-base">{{ employee.gender }}</p>
                        </div>
                        <div class="date_of_birth">
                            <h1 class="text-sm font-bold text-[#1E1E1E66]">DATE OF BIRTH</h1>
                            <p class="text-base">{{ employee.date_of_birth }}</p>
                        </div>
                    </div>
                    <div class="w-[50%] flex flex-col gap-4">
                        <div class="contact_number">
                            <h1 class="text-sm font-bold text-[#1E1E1E66]">CONTACT NUMBER</h1>
                            <p class="text-base">{{ employee.contact_number }}</p>
                        </div>
                        <div class="emergency_contact">
                            <h1 class="text-sm font-bold text-[#1E1E1E66]">EMERGENCY CONTACT</h1>
                            <p class="text-base">{{ employee.emergency_contact }}</p>
                        </div>
                    </div>
                    
                </div>
                
                <div class="w-full sm:w-[50%] flex flex-col gap-4">
                    <div class="barangay">
                        <h1 class="text-sm font-bold text-[#1E1E1E66]">BARANGAY</h1>
                        <p class="text-base">Brgy. {{ employee.barangay }}, {{ employee.city }}, {{employee.province }}</p>
                    </div>
                    <div class="education">
                        <h1 class="text-sm font-bold text-[#1E1E1E66]">EDUCATION</h1>
                        <p class="text-base">{{ employee.highest_education }}</p>
                    </div>
                </div>
            </div>
        </div>
            
        <div class="border-2 border-[#1e1e1e20] w-[100%] h-[1px] rounded-full"></div>

        <div class="w-full px-5 rounded-2xl">
            <div class="flex flex-col md:flex-row w-full gap-4 bg-white rounded-2xl">
                <div class="w-full md:w-[50%] gap-4">
                    <div class="work_experience">
                        <h1 class="text-sm font-bold text-[#1E1E1E66]">WORK EXPERIENCE</h1>
                        {% if employee.work_experience %}
                            <p class="text-base">{{ employee.work_experience }}</p>
                        {% else %}
                            <p class="text-base">No work experience provided.</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="w-full sm:w-[50%] gap-4">
                    <div class="date_of_employment">
                        <h1 class="text-sm font-bold text-[#1E1E1E66]">DATE OF EMPLOYMENT</h1>
                        <p class="text-base">{{ employee.date_of_employment }}</p>
                    </div>
                    <div class="employee_status mt-4">
                        <h1 class="text-sm font-bold text-[#1E1E1E66]">EMPLOYEE STATUS</h1>
                        <p class="text-base pb-5">{{ employee.employee_status }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="w-full h-fit flex flex-col lg:flex-row justify-between gap-5">
        <div class="lg:hidden w-full h-[60px] flex flex-row flex-nowrap justify-end gap-5">
            <div class="w-fit h-full flex gap-2">
                <button id="button" class="text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" onclick="addAttendance()">ADD ATTENDANCE</button>

                <select name="duration" id="duration" class="w-fit h-full px-2 rounded-full border-none bg-gradient-to-r from-[#F8D146] to-[#F5B93F] text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center">
                    <option value="Current Week">Current Week</option>
                    <option value="Last Week">Last Week</option>
                    <option value="Two Weeks Ago">Two Weeks Ago</option>
                    <option value="Last Month">Last Month</option>
                    <option value="Custom">Custom</option>
                </select>
            </div>
        </div>

        <div class="w-full h-[60px] md:h-[100px] lg:w-[300px] lg:h-full flex justify-between flex-row lg:flex-col gap-[15px]">
            <div class="w-fit md:w-full h-full overflow-hidden bg-white border-l-[10px] border-[#F8D146] rounded-r-xl">
                <div class="w-full h-full hidden lg:flex items-center px-4 gap-2">
                    <div class="size-[60px]">
                        <img src="{% static 'images/payroll_status_icon.png' %}" alt="">
                    </div>
                    <div class="flex flex-col justify-between">
                        <h2 id="title" class="font-bold text-base">PAYROLL STATUS</h2>
                        <p class="font-extrabold text-xl text-[#1e1e1e80]">{{ payroll_status }}</p>
                    </div>
                </div>

                <div class="size-full lg:hidden flex flex-col justify-around items-start py-2 px-3 gap-1">
                    <div class="w-full flex justify-start items-center gap-1">
                        <h2 id="title" class="font-bold text-sm md:text-base">STATUS</h2>
                    </div>
                    <p class="font-extrabold text-base md:text-lg text-[#1e1e1e80]">{{ payroll_status }}</p>
                </div>
            </div>

            <div class="w-fit md:w-full lg:w-full h-full overflow-hidden bg-white border-l-[10px] border-[#F8D146] rounded-r-xl">
                <div class="w-full h-full hidden lg:flex items-center px-4 gap-2">
                    <div class="size-[60px]">
                        <img src="{% static 'images/attendance_icon.png' %}" alt="">
                    </div>
                    <div class="flex flex-col justify-between">
                        <h2 id="title" class="font-bold text-base text-nowrap">LAST ATTENDANCE</h2>
                        <p class="font-extrabold text-xl text-[#1e1e1e80]">{{ latest_attendance.date }}</p>
                    </div>
                </div>

                <div class="size-full lg:hidden flex flex-col justify-around items-start py-2 px-3 gap-1">
                    <div class="w-full flex justify-start items-center gap-1">
                        <h2 id="title" class="font-bold text-sm md:text-base">ATTENDANCE</h2>
                    </div>
                    <p class="font-extrabold text-base text-[#1e1e1e80] text-nowrap">{{ latest_attendance.date }}</p>
                </div>
                
            </div>

            <div class="w-fit md:w-full h-full overflow-hidden bg-white border-l-[10px] border-[#F8D146] rounded-r-xl">
                <div class="w-full h-full hidden lg:flex items-center px-4 gap-2">
                    <div class="size-[60px]">
                        <img src="{% static 'images/absences_icon.png' %}" alt="">
                    </div>
                    <div class="flex flex-col justify-between">
                        <h2 id="title" class="font-bold text-base">ABSENCES</h2>
                        <p class="font-extrabold text-xl text-[#1e1e1e80]">{{ employee.absences }} Absences</p>
                    </div>
                </div>

                <div class="size-full lg:hidden flex flex-col justify-around items-start py-2 px-3 gap-1">
                    <div class="w-full flex justify-start items-center gap-1">
                        <h2 id="title" class="font-bold text-sm md:text-base">ABSENCES</h2>
                    </div>
                    <p class="font-extrabold text-base md:text-lg text-[#1e1e1e80]">{{ employee.absences }}</p>
                </div>
            </div>

            <div class="w-fit md:w-full h-full overflow-hidden bg-white border-l-[10px] border-[#F8D146] rounded-r-xl">
                <div class="w-full h-full hidden lg:flex items-center px-4 gap-2">
                    <div class="size-[60px]">
                        <img src="{% static 'images/day_worked_icon.png' %}" alt="">
                    </div>
                    <div class="flex flex-col justify-between">
                        <h2 id="title" class="font-bold text-base">DAYS WORKED</h2>
                        <p class="font-extrabold text-xl text-[#1e1e1e80]">{{ employee.days_worked }} Days</p>
                    </div>
                </div>
                
                <div class="size-full lg:hidden flex flex-col justify-around items-start py-2 px-3 gap-1">
                    <div class="w-full flex justify-start items-center gap-1">
                        <h2 id="title" class="font-bold text-sm md:text-base">WORKED</h2>
                    </div>
                    <p class="font-extrabold text-base md:text-lg text-[#1e1e1e80]">{{ employee.days_worked }} Days</p>
                </div>
            </div>
        </div>
    
        <div class="w-full h-full lg:w-[75%] flex flex-col gap-5">
            <div class="hidden w-full h-[50px] lg:flex flex-row flex-nowrap justify-end gap-5">
                <div class="w-fit h-full flex gap-2">
                    <button id="button" class="text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center" onclick="addAttendance()">ADD ATTENDANCE</button>

                    <select name="duration" id="duration" class="w-fit h-full px-2 rounded-full border-none bg-gradient-to-r from-[#F8D146] to-[#F5B93F] text-xs/3 lg:text-sm/4 font-bold text-[League Spartan] h-full text-center">
                        <option value="Current Week">Current Week</option>
                        <option value="Last Week">Last Week</option>
                        <option value="Two Weeks Ago">Two Weeks Ago</option>
                        <option value="Last Month">Last Month</option>
                        <option value="Custom">Custom</option>
                    </select>
                </div>
            </div>
    
            <div class="w-full h-[75%]">
                <table class="bg-white w-full border border-solid rounded-2xl text-xs-center overflow-hidden">
                    <thead class="border-b-[3px] border-b-[rgba(30,30,30,0.2)]">
                        <tr class="text-base font-[League Spartan]">
                            <th class="py-2">DATE</th>
                            <th>TIME IN</th>
                            <th>TIME OUT</th>
                            <th>TIME WORKED</th>
                            <th></th>
                        </tr>
                    </thead>
                    
                    <tbody>
                        {% for attendance in employee.attendances.all %}
                        <tr data-attendance-id="{{ attendance.id }}">
                            <td>{{ attendance.date }}</td>
                            <td>{{ attendance.time_in }}</td>
                            <td>
                                {% if attendance.time_out %}
                                    {{ attendance.time_out }}
                                {% else %}
                                    <span class="live-time-out">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if attendance.time_out %}
                                    {{ attendance.get_formatted_hours_worked }}
                                {% else %}
                                    <span class="live-hours"
                                        data-timein="{{ attendance.time_in }}"
                                        data-date="{{ attendance.date }}">
                                        Calculating...
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="edit-link no-underline" 
                                    data-id="{{ attendance.attendance_id }}"
                                    data-date="{{ attendance.date|date:'Y-m-d' }}"
                                    data-time-in="{{ attendance.time_in|time:'H:i' }}"
                                    data-time-out="{% if attendance.time_out %}{{ attendance.time_out|time:'H:i' }}{% endif %}"
                                    onclick="editAttendance(this)">
                                    EDIT
                                </span>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5">No attendance records found for {{ employee.first_name }} {{ employee.last_name }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<!--(optional)script-->
{% block script %}
<script>
    function calculateLiveHours() {
        const elements = document.querySelectorAll('.live-hours');
        elements.forEach(el => {
            const timeInStr = el.getAttribute('data-timein');
            const dateStr = el.getAttribute('data-date');

            if (!timeInStr || !dateStr) return;

            const now = new Date();
            const timeIn = new Date(`${dateStr}T${timeInStr}`);

            if (isNaN(timeIn.getTime())) {
                el.textContent = 'Calculating...';
                return;
            }

            const diffMs = now - timeIn;
            if (diffMs < 0) {
                el.textContent = '00:00:00';
                return;
            }

            const totalSeconds = Math.floor(diffMs / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            const pad = n => String(n).padStart(2, '0');
            el.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
        });
    }

    window.addEventListener('load', calculateLiveHours);
    setInterval(calculateLiveHours, 10000);
</script>

<script>
    let table;

    $(document).ready(function () {
        $('#search-input').on('keyup', function () {
            table.search(this.value).draw();
        });
    });
</script>

<script>
    function addAttendance(){
        let bg = document.getElementById("background_add");
        const popup = document.getElementById("add-popup");
        
        // Set today's date as default
        const today = new Date().toISOString().split('T')[0];
        document.getElementById("add_date").value = today;
        
        bg.classList.add("show");
        popup.classList.add("show");
    }
    
    function cancelAddAttendance(){
        let bg = document.getElementById("background_add");
        const popup = document.getElementById("add-popup");
        bg.classList.remove("show");
        popup.classList.remove("show");
    }

    function editAttendance(element) {
        const id = element.getAttribute('data-id');
        const date = element.getAttribute('data-date');
        const timeIn = element.getAttribute('data-time-in');
        const timeOut = element.getAttribute('data-time-out');
        
        document.getElementById("edit_attendance_id").value = id;
        document.getElementById("edit_date").value = date;
        document.getElementById("edit_time_in").value = timeIn;
        document.getElementById("edit_time_out").value = timeOut || '';
        
        // Show the popup
        let bg = document.getElementById("background_edit");
        const popup = document.getElementById("edit-popup");
        bg.classList.add("show");
        popup.classList.add("show");
    }
    
    function cancelEditAttendance(){
        let bg = document.getElementById("background_edit");
        const popup = document.getElementById("edit-popup");
        bg.classList.remove("show");
        popup.classList.remove("show");
    }
    
    // Hide message alerts after 3 seconds
    document.addEventListener('DOMContentLoaded', function() {
        const messages = document.querySelectorAll('.messages .message');
    });
</script>
{% endblock %}