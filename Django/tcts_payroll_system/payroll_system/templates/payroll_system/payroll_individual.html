{% extends 'base.html' %}
{% load static %}

<!--title-->
{% block title %}{{ employee.first_name }} {{ employee.last_name }}'s Payroll Profile{% endblock %}

<!--(optional)head content-->
{% block headcontent %}
<link rel="stylesheet" href="{% static 'css/payroll_individual.css'%}">
<link rel="stylesheet" href="{% static 'css/table.css'%}">
<link rel="stylesheet" href="{% static 'css/default_design.css' %}">

{% endblock %}

<!--header-->
{% block header %}PAYROLL{% endblock %} 

<!--page content-->

{% block outsidecontent %}
<div id="background" class="background absolute m-0 size-full bg-[rgba(30,30,30,0.5)] invisible opacity-0 z-50" onclick="cancelEditIncentives()">
    
</div> 

<div id="incentive-popup" class="edit_incentives_popup absolute w-[40%] py-5 px-10 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col justify-around invisible opacity-0 rounded-lg bg-white z-60 overflow-hidden">
    <h1>Add/Deduct for {{ employee.first_name }} {{ employee.last_name }}</h1>
    <form class="flex flex-col" method="post" onsubmit="event.preventDefault(); saveIncentives();">
        <div class="flex items-center my-2" >
            <div id="add-radio" class="flex flex-wrap">
                <label class="relative flex items-center cursor-pointer" for="add">
                    <input id="add" name="incentives" type="radio" class="peer h-5 w-5 cursor-pointer appearance-none rounded-full border border-slate-300 checked:border-yellow-400 transition-all"/>
                    <span class="absolute bg-[#F8D146] w-3 h-3 rounded-full opacity-0 peer-checked:opacity-100 transition-opacity duration-200 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></span>
                </label>
                <p id="label">add</p>
            </div>
            
            <div id="subtract-checkbox" class="flex flex-wrap">
                <label class="relative flex items-center cursor-pointer" for="subtract">
                    <input id="subtract" name="incentives" type="radio" class="peer h-5 w-5 cursor-pointer appearance-none rounded-full border border-slate-300 checked:border-yellow-400 transition-all"/>
                    <span class="absolute bg-[#F8D146] w-3 h-3 rounded-full opacity-0 peer-checked:opacity-100 transition-opacity duration-200 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></span>
                </label>
                <p id="label">subtract</p>
            </div>
        </div>

        <div class="flex flex-col my-2">
            <input type="text" name="incentives" id="field" class="field" placeholder="ex. 1000.00">
        </div>

        <div class="w-full h-[40px] my-1 flex justify-end gap-3">
            <input type="button" class="size-full" value="CANCEL" onclick="cancelEditIncentives()">
            <input type="submit" class="size-full" value="CONFIRM">
        </div>
    </form>   
</div>
{% endblock %}

{% block content %}
<div class="w-full grid grid-cols-2 md:grid-cols-[2fr_6fr] lg:grid-cols-[1fr_6fr_6fr] md:grid-rows-[1fr_80px_auto_auto] lg:grid-rows-[100px_auto_auto] gap-3 z-10">

    <div class="order-1 col-span-2 md:col-span-1 rounded-full w-full flex justify-center min-w-[125px] md:min-w-[100px]">
        {% if employee.active_status %}
            <img class="rounded-full size-[125px] lg:size-[100px] object-cover" src="{{ employee.employee_image.url }}" alt="">
        {% else %}
            <img class="rounded-full size-[125px] lg:size-[100px] object-cover" src="{% static 'images/employee_image' %}" alt="">
        {% endif %}
    </div>

    <div id="status" class="order-3 lg:order-2 col-span-3 lg:col-span-1 size-full flex justify-center items-start lg:items-end">
        <div class="h-[80%] lg:h-[70%] px-4 w-full bg-white rounded-full flex justify-evenly items-center gap-2">
            <div id="name">
                <p class="text-[#F8D146] text-sm xl:text-base font-bold text-[Roboto] text-center">{{ employee.first_name }} {{ employee.middle_name }} {{ employee.last_name }}</p>
            </div>
    
            <span class="w-[1.5px] h-[60%] bg-black rounded-full"></span> <!--horizontal line-->
    
            <div id="attendance">
                <p class="text-sm xl:text-base text-[Inter]">
                    {% if employee.active_status %}
                        Active
                    {% else %}
                        Inactive
                    {% endif %}
                </p>
            </div>
    
            <span class="w-[1.5px] h-[60%] bg-black rounded-full"></span> <!--horizontal line-->
            
            <div id="payroll">
                <p class="text-sm xl:text-base text-[Inter]">
                    {% if current_payroll %}
                        {{ current_payroll.payroll_status }}
                    {% else %}
                        None
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <div id="buttons" class="order-2 lg:order-3 col-span-2 lg:col-span-1 flex justify-end items-end gap-2">
        <a href="{% url 'payroll_system:employee_profile' employee.employee_id %}">
            <button id="button_2" class="h-[40px] lg:h-[50px] font-bold text-sm/4 lg:text-base/4 text-[League Spartan] overflow-hidden">CHECK PROFILE</button>
        </a>
        <button id="button_1" class="h-[40px] lg:h-[50px] flex justify-center items-center gap-2 overflow-hidden" onclick="editIncentives()">
            <p class="text-[#FFF] font-bold text-sm/4 lg:text-base/4 text-[League Spartan]">EMPLOYEES' INCENTIVES</p>
            <img src="{% static 'images/edit_icon.png' %}" alt="">
        </button>
    </div>


    <!--large devices-->
    <div id="current_payroll" class="order-4 hidden xl:block col-span-3 w-full">
        <table id="current_payroll_table" class="bg-white w-full border-none rounded-2xl text-xs-center overflow-hidden shadow-lg">
            <thead class="border-b-[3px] border-b-[rgba(30,30,30,0.2)]">
                <tr class="text-base font-[League Spartan]">
                    <th class="p-2 text-base font-[League Spartan]">RATE PER DAY</th>
                    <th class="p-2 text-base font-[League Spartan]">TOTAL ATTENDANCE</th>
                    <th class="p-2 text-base font-[League Spartan]">TOTAL INCENTIVES</th>
                    <th class="p-2 text-base font-[League Spartan]">TOTAL PAYMENT AMOUNT</th>
                    <th class="p-2 text-base font-[League Spartan]">OTHERS</th> <!--add to payment amt (cash advance)-->
                    <th class="p-2 text-base font-[League Spartan]">DEDUCTIONS</th>
                    <th class="p-2 text-base font-[League Spartan]">DATE OF PAY</th>
                    <th class="p-2 text-base font-[League Spartan]"></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    {% if current_payroll %}
                        <td class="p-2 text-sm font-[Inter]">{{ current_payroll.rate }}</td>
                        <td class="p-2 text-sm font-[Inter]">{{ attendance_count }}</td>
                        <td id="total-incentives" class="p-2 text-sm font-[Inter] incentive-display">{{ current_payroll.incentives|default:"0.00" }}</td>                        
                        <td class="p-2 text-sm font-[Inter] salary-display">{{ current_payroll.salary }}</td>
                        <td class="p-2 text-sm font-[Inter]"><!--{ other ++pay cash advance }}--> 0.00</td>
                        <td class="p-2 text-sm font-[Inter]"><!--{ deductions }}--> 0.00</td>
                        <td class="p-2 text-sm font-[Inter]">{{ current_payroll.payment_date }}</td>
                        <td class="p-3 w-full h-[30%] flex justify-center items-center">
                            <a class="h-8.5 w-8.5 flex-shrink-0" href="{% url 'payroll_system:payroll_edit' employee.employee_id %}">
                                <img class="cursor-pointer" src="{% static 'images/payroll_edit_icon.png' %}" alt="">
                            </a>
                        </td>
                    {% else %}
                        <td class="p-2 text-sm font-[Inter]">0.00</td>
                        <td class="p-2 text-sm font-[Inter]">{{ attendance_count|default:"0" }}</td>
                        <td class="p-2 text-sm font-[Inter]">0.00</td>
                        <td class="p-2 text-sm font-[Inter]">0.00</td>
                        <td class="p-2 text-sm font-[Inter]">N/A</td>
                        <td class="p-2 text-sm font-[Inter]">0.00</td>
                        <td class="p-2 text-sm font-[Inter]">0.00</td>
                        <td class="p-3 w-full h-full py-2 flex justify-center items-center">
                            <a class="h-8.5 w-8.5 flex-shrink-0" href="{% url 'payroll_system:payroll_edit' employee.employee_id %}">
                                <img class="cursor-pointer" src="{% static 'images/payroll_edit_icon.png' %}" alt="">
                            </a>
                        </td>
                    {% endif %}
                </tr>
            </tbody>
        </table>
    </div>

    <div class="order-5 hidden xl:block col-span-3 flex flex-col justify-center gap-3">
        <div class="w-full flex justify-center items-center">
            <h1 class="py-2 text-xl font-extrabold text-[League Spartan]">PAYROLL HISTORY</h1>
        </div>
        <div id="table">
            <table class="bg-white w-full border-none rounded-2xl text-xs-center overflow-hidden">
                <thead class="border-b-[3px] border-b-[rgba(30,30,30,0.2)]">
                    <tr class="text-base font-[League Spartan]">
                        <th class="p-2 text-base font-[League Spartan]">RATE PER DAY</th>
                        <th class="p-2 text-base font-[League Spartan]">TOTAL ATTENDANCE</th>
                        <th class="p-2 text-base font-[League Spartan]">TOTAL INCENTIVES</th>
                        <th class="p-2 text-base font-[League Spartan]">TOTAL PAYMENT AMOUNT</th>
                        <th class="p-2 text-base font-[League Spartan]">OTHERS</th>
                        <th class="p-2 text-base font-[League Spartan]">DEDUCTIONS</th>
                        <th class="p-2 text-base font-[League Spartan]">DATE OF PAY</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="payroll-data" class="h-[50px]">
                        {% if current_payroll %}
                            <td class="p-2 text-sm font-[Inter]">{{ current_payroll.rate }}</td>
                            <td class="p-2 text-sm font-[Inter]">
                                {% with attendance_count=employee.attendances.count %}
                                    {{ attendance_count|default:"0" }}
                                {% endwith %}
                            </td>
                            <td class="p-2 text-sm font-[Inter]">{{ current_payroll.incentives }}</td>
                            <td class="p-2 text-sm font-[Inter]">{{ current_payroll.salary }}</td>
                            <td class="p-2 text-sm font-[Inter]"><!--{OTHERS }-->0.00</td>
                            <td class="p-2 text-sm font-[Inter]"><!--{deductions}-->0.00</td>
                            <td class="p-2 text-sm font-[Inter]">{{ current_payroll.payment_date }}</td>
                        {% else %}
                            <td class="p-2 text-sm font-[Inter]">0.00</td>
                            <td class="p-2 text-sm font-[Inter]">N/A</td>
                            <td class="p-2 text-sm font-[Inter]">0.00</td>
                            <td class="p-2 text-sm font-[Inter]">0.00</td>
                            <td class="p-2 text-sm font-[Inter]">0.00</td>
                            <td class="p-2 text-sm font-[Inter]">0.00</td>
                            <td class="p-2 text-sm font-[Inter]">N/A</td>
                        {% endif %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!--medium devices-->
    <div id="current_payroll" class="order-4 hidden md:block xl:hidden col-span-3 w-full">
        <table id="current_payroll_table" class="bg-white w-full border-none rounded-2xl text-xs-center overflow-hidden shadow-lg">
            <thead class="border-b-[3px] border-b-[rgba(30,30,30,0.2)]">
                <tr class="">
                    <th class="p-2 text-sm font-[League Spartan]">RATE</th>
                    <th class="p-2 text-sm font-[League Spartan]">ATTENDANCE</th>
                    <th class="p-2 text-sm font-[League Spartan]">INCENTIVES</th>
                    <th class="p-2 text-sm font-[League Spartan]">PAYMENT AMOUNT</th>
                    <th class="p-2 text-sm font-[League Spartan]">PAY DATE</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    {% if current_payroll %}
                        <td class="p-2 text-xs font-[Inter]">{{ current_payroll.rate }}</td>
                        <td class="px-2 text-xs font-[Inter]">{{ attendance_count }}</td>
                        <td class="px-2 text-xs font-[Inter] incentive-display">{{ current_payroll.incentives|default:"0.00" }}</td>
                        <td class="px-2 text-xs font-[Inter] salary-display">{{ current_payroll.salary }}</td>
                        <td class="px-2 text-xs font-[Inter]">{{ current_payroll.payment_date }}</td>
                        <td class="p-3 flex justify-center items-center">
                            <a class="h-7.5 w-7.5 flex-shrink-0" href="{% url 'payroll_system:payroll_edit' employee.employee_id %}">
                                <img class="cursor-pointer" src="{% static 'images/payroll_edit_icon.png' %}" alt="">
                            </a>
                        </td>
                    {% else %}
                        <td class="px-2 text-xs font-[Inter]">0.00</td>
                        <td class="px-2 text-xs font-[Inter]">{{ attendance_count|default:"0" }}</td>
                        <td class="px-2 text-xs font-[Inter]">0.00</td>
                        <td class="px-2 text-xs font-[Inter]">0.00</td>
                        <td class="px-2 text-xs font-[Inter]">N/A</td>
                        <td class="p-3 flex justify-center items-center">
                            <a class="h-7.5 w-7.5 flex-shrink-0" href="{% url 'payroll_system:payroll_edit' employee.employee_id %}">
                                <img class="cursor-pointer" src="{% static 'images/payroll_edit_icon.png' %}" alt="">
                            </a>
                        </td>
                    {% endif %}
                </tr>
            </tbody>
        </table>
    </div>

    <div class="order-5 hidden md:block xl:hidden col-span-3 flex flex-col justify-center gap-3">
        <div class="w-full flex justify-center items-center">
            <h1 class="py-2 text-lg font-extrabold text-[League Spartan]">PAYROLL HISTORY</h1>
        </div>
        <div id="table">
            <table class="bg-white w-full border-none rounded-2xl text-xs-center overflow-hidden">
                <thead class="border-b-[3px] border-b-[rgba(30,30,30,0.2)]">
                    <tr>
                        <th class="p-2 text-sm font-[League Spartan]">RATE</th>
                        <th class="p-2 text-sm font-[League Spartan]">ATTENDANCE</th>
                        <th class="p-2 text-sm font-[League Spartan]">INCENTIVES</th>
                        <th class="p-2 text-sm font-[League Spartan]">PAYMENT AMOUNT</th>
                        <th class="p-2 text-sm font-[League Spartan]">PAY DATE</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="payroll-data" class="h-[50px]">
                        {% if current_payroll %}
                            <td class="px-2 text-xs font-[Inter]">{{ current_payroll.rate }}</td>
                            <td class="px-2 text-xs font-[Inter]">
                                {% with attendance_count=employee.attendances.count %}
                                    {{ attendance_count|default:"0" }}
                                {% endwith %}
                            </td>
                            <td class="px-2 text-xs font-[Inter]">{{ current_payroll.incentives }}</td>
                            <!-- <td>{{ current_payroll.deductions }}</td> -->
                            <td class="px-2 text-xs font-[Inter]">{{ current_payroll.salary }}</td>
                            <td class="px-2 text-xs font-[Inter]">{{ current_payroll.payment_date }}</td>
                        {% else %}
                            <td class="px-2 text-xs font-[Inter]">0.00</td>
                            <td class="px-2 text-xs font-[Inter]">N/A</td>
                            <td class="px-2 text-xs font-[Inter]">0.00</td>
                            <!-- <td>0.00</td> -->
                            <td class="px-2 text-xs font-[Inter]">0.00</td>
                            <td class="px-2 text-xs font-[Inter]">N/A</td>
                        {% endif %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!--small devices-->
    <div id="current_payroll" class="order-4 md:hidden col-span-3 w-full">
        <table id="current_payroll_table" class="bg-white w-full border-none rounded-2xl text-xs-center overflow-hidden shadow-lg">
            <thead class="border-b-[3px] border-b-[rgba(30,30,30,0.2)]">
                <tr class="text-base font-[League Spartan]">
                    <th class="p-2 text-xs font-[League Spartan]">RATE</th>
                    <th class="p-2 text-xs font-[League Spartan]">ATTENDANCE</th>
                    <th class="p-2 text-xs font-[League Spartan]">INCENTIVES</th>
                    <th class="p-2 text-xs font-[League Spartan]">PAYMENT AMOUNT</th>
                    <th class="p-2 text-xs font-[League Spartan]">PAY DATE</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    {% if current_payroll %}
                        <td class="p-2 text-[10px] font-[Inter]">{{ current_payroll.rate }}</td>
                        <td class="px-2 text-[10px] font-[Inter]">{{ attendance_count }}</td>
                        <td class="px-2 text-[10px] font-[Inter] incentive-display">{{ current_payroll.incentives|default:"0.00" }}</td>
                        <td class="px-2 text-[10px] font-[Inter] salary-display">{{ current_payroll.salary }}</td>
                        <td class="px-2 text-[10px] font-[Inter]">{{ current_payroll.payment_date }}</td>
                        <td class="p-3 flex justify-center items-center">
                            <a class="h-7.5 w-7.5 flex-shrink-0" href="{% url 'payroll_system:payroll_edit' employee.employee_id %}">
                                <img class="cursor-pointer" src="{% static 'images/payroll_edit_icon.png' %}" alt="">
                            </a>
                        </td>
                    {% else %}
                        <td class="px-2 text-[10px] font-[Inter]">0.00</td>
                        <td class="px-2 text-[10px] font-[Inter]">{{ attendance_count|default:"0" }}</td>
                        <td class="px-2 text-[10px] font-[Inter]">0.00</td>
                        <td class="px-2 text-[10px] font-[Inter]">0.00</td>
                        <td class="px-2 text-[10px] font-[Inter]">N/A</td>
                        <td class="p-3 flex justify-center items-center">
                            <a class="h-7.5 w-7.5 flex-shrink-0" href="{% url 'payroll_system:payroll_edit' employee.employee_id %}">
                                <img class="cursor-pointer" src="{% static 'images/payroll_edit_icon.png' %}" alt="">
                            </a>
                        </td>
                    {% endif %}
                </tr>
            </tbody>
        </table>
    </div>

    <div class="order-5 md:hidden col-span-3 flex flex-col justify-center gap-3">
        <div class="w-full flex justify-center items-center">
            <h1 class="text-base font-extrabold text-[League Spartan]">PAYROLL HISTORY</h1>
        </div>
        <div id="table">
            <table class="bg-white w-full border-none rounded-2xl text-xs-center overflow-hidden">
                <thead class="border-b-[3px] border-b-[rgba(30,30,30,0.2)]">
                    <tr>
                        <th class="p-2 text-xs font-[League Spartan]">RATE</th>
                        <th class="p-2 text-xs font-[League Spartan]">ATTENDANCE</th>
                        <th class="p-2 text-xs font-[League Spartan]">INCENTIVES</th>
                        <th class="p-2 text-xs font-[League Spartan]">PAYMENT AMOUNT</th>
                        <th class="p-2 text-xs font-[League Spartan]">PAY DATE</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="payroll-data" class="h-[50px]">
                        {% if current_payroll %}
                            <td class="px-2 text-[10px] font-[Inter]">{{ current_payroll.rate }}</td>
                            <td class="px-2 text-[10px] font-[Inter]">
                                {% with attendance_count=employee.attendances.count %}
                                    {{ attendance_count|default:"0" }}
                                {% endwith %}
                            </td>
                            <td class="px-2 text-[10px] font-[Inter]">{{ current_payroll.incentives }}</td>
                            <!-- <td>{{ current_payroll.deductions }}</td> -->
                            <td class="px-2 text-[10px] font-[Inter]">{{ current_payroll.salary }}</td>
                            <td class="px-2 text-[10px] font-[Inter]">{{ current_payroll.payment_date }}</td>
                        {% else %}
                            <td class="px-2 text-[10px] font-[Inter]">0.00</td>
                            <td class="px-2 text-[10px] font-[Inter]">N/A</td>
                            <td class="px-2 text-[10px] font-[Inter]">0.00</td>
                            <!-- <td>0.00</td> -->
                            <td class="px-2 text-[10px] font-[Inter]">0.00</td>
                            <td class="px-2 text-[10px] font-[Inter]">N/A</td>
                        {% endif %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

<!--(optional)script-->
{% block script %}
<script>
    // Global variables to keep track of incentives
    let employeeIncentives = {};
    const employeeId = {{ employee.employee_id }};  // Get the current employee ID from Django context
    
    function editIncentives(){
        const bg = document.getElementById("background");
        const popup = document.getElementById("incentive-popup");
        bg.classList.add("show");
        popup.classList.add("show");
        
        // Load existing incentives if any
        const currentIncentive = employeeIncentives[employeeId] || { type: 'add', amount: '' };
        
        // Set the radio button for the incentive type
        document.getElementById(currentIncentive.type).checked = true;
        
        // Set the amount field
        document.getElementById('field').value = currentIncentive.amount || '';
    }
    
    function cancelEditIncentives(){
        const bg = document.getElementById("background");
        const popup = document.getElementById("incentive-popup");
        bg.classList.remove("show");
        popup.classList.remove("show");
    }
</script>
{% endblock %}
