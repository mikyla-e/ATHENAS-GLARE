{% extends 'base.html' %}
{% load static %}

<!--title-->
{% block title %}Registering Employee...{% endblock %}

<!--(optional)head content-->
{% block headcontent %}
<link rel="stylesheet" href="{% static 'css/default_design.css' %}">

{% endblock %}

<!--header-->
{% block header %}EMPLOYEES{% endblock %} 

<!--page content-->
{% block content %}
<div class="size-full">
    <div class="my-4 mx-5 font-[League Spartan] text-3xl/10 font-bold">
        <p id="title" class="text-[#1E1E1E] px-2">Add Employee!</p>
    </div>
    
    <div class="px-5">
        <form class="grid grid-row-[1fr_1fr] md:grid-row-1 md:grid-cols-[40%_40%] md:gap-10" method="POST">
            {% csrf_token %}
        
            <div class="order-1">
                <div class="flex flex-col my-1">
                    <div class="">
                        <label for="first-name" class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]">first name</label>
                        {% if form.first_name.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.first_name.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    {{ form.first_name }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="middle-name">middle name</label>
                        {% if form.middle_name.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.middle_name.errors.0 }}</div>
                        {% endif %}
                    </div>

                    {{ form.middle_name }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="last-name">last name</label>
                        {% if form.last_name.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.last_name.errors.0 }}</div>
                        {% endif %}
                    </div>

                    {{ form.last_name }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="gender">gender</label>
                        {% if form.gender.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.gender.errors.0 }}</div>
                        {% endif %}
                    </div>

                    {{ form.gender }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="date-of-birth">date of birth</label>
                        {% if form.date_of_birth.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.date_of_birth.errors.0 }}</div>
                        {% endif %}
                    </div>

                    {{ form.date_of_birth }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="contact-number">contact number</label>
                        {% if form.contact_number.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.contact_number.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    {{ form.contact_number }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="emergency-contact">emergency contact</label>
                        {% if form.emergency_contact.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.emergency_contact.errors.0 }}</div>
                        {% endif %}
                    </div>
                    {{ form.emergency_contact }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="{{ form.region.id_for_label }}">{{ form.region.label }}</label>
                        {% if form.region.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.region.errors.0 }}</div>
                        {% endif %}
                    </div>
                    {{ form.region }}
                    <datalist id="region-list">
                        {% for region in regions %}
                            <option value="{{ region.regDesc }}" data-code="{{ region.regCode }}">
                        {% endfor %}
                    </datalist>
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="{{ form.province.id_for_label }}">{{ form.province.label }}</label>
                        {% if form.province.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.province.errors.0 }}</div>
                        {% endif %}
                    </div>
                    {{ form.province }}
                    <datalist id="province-list">
                    </datalist>
                </div>
            </div>
        
            <div class="order-2">
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="{{ form.city.id_for_label }}">{{ form.city.label }}</label>
                        {% if form.city.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.city.errors.0 }}</div>
                        {% endif %}
                    </div>

                    {{ form.city }}
                    <datalist id="city-list">
                    </datalist>
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="{{ form.barangay.id_for_label }}">{{ form.barangay.label }}</label>
                        {% if form.barangay.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.barangay.errors.0 }}</div>
                        {% endif %}
                    </div>
                    {{ form.barangay }}
                    <datalist id="barangay-list">
                    </datalist>
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="education">highest education attainment</label>
                        {% if form.highest_education.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.highest_education.errors.0 }}</div>
                        {% endif %}
                    </div>

                    {{ form.highest_education }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="work-experience">work experience</label>
                        {% if form.work_experience.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.work_experience.errors.0 }}</div>
                        {% endif %}
                    </div>
                    {{ form.work_experience }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="date-of-employment">date of employment</label>
                        {% if form.date_of_employment.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.date_of_employment.errors.0 }}</div>
                        {% endif %}
                    </div>
                    {{ form.date_of_employment }}
                </div>
                <div class="flex flex-col my-1">
                    <div class="">
                        <label class="mx-[20px] font-[Inter] text-xs md:text-[14px] font-semibold text-[#1E1E1E]" for="employee-status">employee status</label>
                        {% if form.employee_status.errors %}
                            <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ form.employee_status.errors.0 }}</div>
                        {% endif %}
                    </div>
                    {{ form.employee_status }}
                </div>
                
                <div class="w-full h-[50px] flex justify-end items-center gap-5">
                    {% if form.non_field_errors %}
                        <div class="non-field-errors">
                            {% for error in form.non_field_errors %}
                                <div class="text-[#e74c3c] text-[9px] md:text-xs font-bold inline-block">{{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <input class="size-full text-xs/3 lg:text-base/4 font-bold text-[League Spartan] text-center" type="submit" value="PROCEED TO PHOTO" />
                </div>    
            </div>
        </form>
    </div>
</div>
{% endblock %}

<!--(optional)script-->
{% block script %}
<script src="{% static 'javascript/phLocations.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        initializeAddressFields({
            regionInputId: "region-dropdown",
            provinceInputId: "province-dropdown",
            cityInputId: "city-dropdown",
            barangayInputId: "barangay-dropdown",
            regionListId: "region-list",
            provinceListId: "province-list",
            cityListId: "city-list",
            barangayListId: "barangay-list",
            baseUrl: "/payroll_system/ajax"
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get the date of birth input field
        const dobInput = document.querySelector('input[name="date_of_birth"]');
        
        if (dobInput) {
            // Calculate date 18 years ago
            const today = new Date();
            const defaultDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
            
            // Format as YYYY-MM-DD for the date input
            const defaultDateStr = defaultDate.toISOString().split('T')[0];
            
            // Set the default date when the input is clicked but not yet filled
            dobInput.addEventListener('focus', function() {
                if (!this.value) {
                    // Only set default if no value is already selected
                    this.valueAsDate = defaultDate;
                }
            });
        }
    });

    // document.addEventListener("DOMContentLoaded", function () {
    //     // Get elements
    //     const regionInput = document.getElementById("region-dropdown");
    //     const provinceInput = document.getElementById("province-dropdown");
    //     const cityInput = document.getElementById("city-dropdown");
    //     const barangayInput = document.getElementById("barangay-dropdown");
        
    //     const provinceList = document.getElementById("province-list");
    //     const cityList = document.getElementById("city-list");
    //     const barangayList = document.getElementById("barangay-list");

    //     // Store current location codes
    //     let currentRegionCode = "";
    //     let currentProvinceCode = "";
    //     let currentCityCode = "";
        
    //     // Function to enable/disable fields based on their dependencies
    //     function updateFieldStates() {
    //         if (provinceInput) {
    //             provinceInput.disabled = !regionInput?.value;
    //         }
    //         if (cityInput) {
    //             cityInput.disabled = !provinceInput?.value;
    //         }
    //         if (barangayInput) {
    //             barangayInput.disabled = !cityInput?.value;
    //         }
    //     }

    //     // Function to fetch provinces for a region
    //     function fetchProvinces(regionCode) {
    //         if (!regionCode) return;
            
    //         fetch(`/payroll_system/ajax/get-provinces/?region=${regionCode}`)
    //             .then(response => response.json())
    //             .then(data => {
    //                 if (provinceList) {
    //                     provinceList.innerHTML = "";
    //                     data.provinces.forEach(p => {
    //                         const option = document.createElement("option");
    //                         option.value = p.provDesc;
    //                         option.setAttribute("data-code", p.provCode);
    //                         provinceList.appendChild(option);
    //                     });
                        
    //                     // If province has a value, trigger its input handler
    //                     if (provinceInput && provinceInput.value) {
    //                         const event = new Event('input');
    //                         provinceInput.dispatchEvent(event);
    //                     }
    //                 }
    //             })
    //             .catch(error => console.error("Error fetching provinces:", error));
    //     }

    //     // Function to fetch cities for a province
    //     function fetchCities(provinceCode) {
    //         if (!provinceCode) return;
            
    //         fetch(`/payroll_system/ajax/get-cities/?province=${provinceCode}`)
    //             .then(response => response.json())
    //             .then(data => {
    //                 if (cityList) {
    //                     cityList.innerHTML = "";
    //                     data.cities.forEach(c => {
    //                         const option = document.createElement("option");
    //                         option.value = c.citymunDesc;
    //                         option.setAttribute("data-code", c.citymunCode);
    //                         cityList.appendChild(option);
    //                     });
                        
    //                     // If city has a value, trigger its input handler
    //                     if (cityInput && cityInput.value) {
    //                         const event = new Event('input');
    //                         cityInput.dispatchEvent(event);
    //                     }
    //                 }
    //             })
    //             .catch(error => console.error("Error fetching cities:", error));
    //     }

    //     // Function to fetch barangays for a city
    //     function fetchBarangays(cityCode) {
    //         if (!cityCode) return;
            
    //         fetch(`/payroll_system/ajax/get-barangays/?city=${cityCode}`)
    //             .then(response => response.json())
    //             .then(data => {
    //                 if (barangayList) {
    //                     barangayList.innerHTML = "";
    //                     data.barangays.forEach(b => {
    //                         const option = document.createElement("option");
    //                         option.value = b.brgyDesc;
    //                         option.setAttribute("data-code", b.brgyCode);
    //                         barangayList.appendChild(option);
    //                     });
    //                 }
    //             })
    //             .catch(error => console.error("Error fetching barangays:", error));
    //     }

    //     // Setup event listeners if elements exist
    //     if (regionInput) {
    //         regionInput.addEventListener("change", function() {
    //             if (!this.value) {
    //                 if (provinceInput) provinceInput.value = "";
    //                 if (cityInput) cityInput.value = "";
    //                 if (barangayInput) barangayInput.value = "";
    //             }
    //             updateFieldStates();
    //         });
            
    //         regionInput.addEventListener("input", function() {
    //             const selectedOption = document.querySelector(`#region-list option[value="${regionInput.value}"]`);
    //             if (selectedOption) {
    //                 currentRegionCode = selectedOption.dataset.code;
    //                 if (provinceInput) provinceInput.value = "";
    //                 if (cityInput) cityInput.value = "";
    //                 if (barangayInput) barangayInput.value = "";
                    
    //                 fetchProvinces(currentRegionCode);
    //             }
    //         });
            
    //         // If region already has a value on page load, fetch provinces
    //         if (regionInput.value) {
    //             const selectedOption = document.querySelector(`#region-list option[value="${regionInput.value}"]`);
    //             if (selectedOption) {
    //                 currentRegionCode = selectedOption.dataset.code;
    //                 fetchProvinces(currentRegionCode);
    //             }
    //         }
    //     }
        
    //     if (provinceInput) {
    //         provinceInput.addEventListener("change", function() {
    //             if (!this.value) {
    //                 if (cityInput) cityInput.value = "";
    //                 if (barangayInput) barangayInput.value = "";
    //             }
    //             updateFieldStates();
    //         });
            
    //         provinceInput.addEventListener("input", function() {
    //             const selectedOption = document.querySelector(`#province-list option[value="${provinceInput.value}"]`);
    //             if (selectedOption) {
    //                 currentProvinceCode = selectedOption.dataset.code;
    //                 if (cityInput) cityInput.value = "";
    //                 if (barangayInput) barangayInput.value = "";
                    
    //                 fetchCities(currentProvinceCode);
    //             }
    //         });
            
    //         // If province already has a value on page load, fetch cities
    //         if (provinceInput.value) {
    //             const selectedOption = document.querySelector(`#province-list option[value="${provinceInput.value}"]`);
    //             if (selectedOption) {
    //                 currentProvinceCode = selectedOption.dataset.code;
    //                 fetchCities(currentProvinceCode);
    //             }
    //         }
    //     }
        
    //     if (cityInput) {
    //         cityInput.addEventListener("change", function() {
    //             if (!this.value) {
    //                 if (barangayInput) barangayInput.value = "";
    //             }
    //             updateFieldStates();
    //         });
            
    //         cityInput.addEventListener("input", function() {
    //             const selectedOption = document.querySelector(`#city-list option[value="${cityInput.value}"]`);
    //             if (selectedOption) {
    //                 currentCityCode = selectedOption.dataset.code;
    //                 if (barangayInput) barangayInput.value = "";
                    
    //                 fetchBarangays(currentCityCode);
    //             }
    //         });
            
    //         // If city already has a value on page load, fetch barangays
    //         if (cityInput.value) {
    //             const selectedOption = document.querySelector(`#city-list option[value="${cityInput.value}"]`);
    //             if (selectedOption) {
    //                 currentCityCode = selectedOption.dataset.code;
    //                 fetchBarangays(currentCityCode);
    //             }
    //         }
    //     }
        
    //     // Initialize field states based on current values
    //     updateFieldStates();
    // });

</script>

{% endblock %}
